<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Verification & Instructions</title>
    <style>
        /* Responsive CSS for Mobile/PC Friendliness */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #0056b3;
            text-align: center;
        }

        .step {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px 0;
            width: 100%; /* Full width on mobile */
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Specific style for the copy button */
        #copyInstructionsBtn {
            background-color: #28a745;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        #copyInstructionsBtn:hover {
            background-color: #1e7e34;
        }


        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0 20px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .product-list-item {
            padding: 8px;
            border-bottom: 1px dashed #eee;
        }

        .correction-form {
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .final-step-note {
            background-color: #fffff0;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }

        .hidden {
            display: none;
        }

        /* Responsive Breakpoint for larger screens (PC) */
        @media (min-width: 600px) {
            button {
                width: auto;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üì¶ Product Setup Assistant</h1>

        <div id="step-scan" class="step">
            <h2>1. Enter Product Model IDs</h2>
            <p>Please type the model ID found on each product box label one at a time.</p>

            <input type="text" id="manualInput" placeholder="Type Model ID (e.g., BMRX-200)">
            <button id="addInputBtn">‚ûï Add Product ID</button>
            
            <p><strong>IDs Entered:</strong> <span id="scannedIDs">None</span></p>

            <button id="doneScanningBtn" disabled>‚úÖ Done Entering (0 products)</button>
        </div>

        <div id="step-verify" class="step hidden">
            <h2>2. Verify Product List</h2>
            <p>Please confirm the following product list matches the items you received:</p>
            
            <div id="finalProductList"></div>

            <button id="listCorrectBtn">‚úÖ Yes, the list is correct</button>
            <button id="listIncorrectBtn">‚ùå No, I need to correct it</button>

            <div id="correctionArea" class="correction-form hidden">
                <h3>Correction</h3>
                <p>Please enter the corrected, comma-separated list of ALL model IDs (e.g., BMRX-200, NCR-86):</p>
                <input type="text" id="correctionInput" placeholder="Enter corrected list of IDs">
                <button id="applyCorrectionBtn">Apply Correction & Verify</button>
            </div>
        </div>

        <div id="step-instructions" class="step hidden">
            <h2>3. Your Custom Instructions</h2>
            <p>Based on your products, here are the resources you need:</p>
            
            <div id="instructionsContent">
                </div>
            
            <hr>
            
            <button id="copyInstructionsBtn">üìã Copy Instructions to Clipboard</button>

            <div class="final-step-note">
                <p><strong>Done!</strong> Please open your email app (or notes app) and **Paste** the copied text to save these links for future reference.</p>
                <p id="copyStatus" style="font-weight: bold; color: green;"></p>
            </div>
        </div>

    </div>

    <script>
        // --- 1. FICTIONAL PRODUCT DATA SIMULATION (Using provided models/links) ---
        const FICTIONAL_PRODUCTS = {
            'BMRX-200': {
                name: 'BMRX Rotary Level Indicator',
                manual: 'https://support.binmaster.com/hc/en-us/articles/37573907689876-BMRX-Rotary-Manuals',
                wiring: 'https://support.binmaster.com/hc/en-us/articles/36000000000-Rotary-Wiring-Diagram', // Fictional specific wiring link
                guide: 'Silo Measuring Guide A: Rotary Installation'
            },
            'NCR-86': {
                name: 'NCR-86 Continuous Level Transmitter',
                manual: 'https://support.binmaster.com/hc/en-us/articles/37573629903124-Manual-NCR-86-and-NCR-80',
                wiring: 'https://support.binmaster.com/hc/en-us/articles/36000000001-Transmitter-Power-Data-Wiring', // Fictional specific wiring link
                guide: 'Silo Measuring Guide B: Through-Air Radar Setup'
            },
            'C-100': {
                name: 'C-100 Tilt Switch',
                manual: 'https://support.binmaster.com/hc/en-us/articles/37572698326164-C100-Manuals',
                wiring: 'https://support.binmaster.com/hc/en-us/articles/36000000002-Tilt-Switch-Wiring-Diagram', // Fictional specific wiring link
                guide: 'N/A'
            },
            // Added another generic product to test the "N/A" and mixing models
            'CABLE-50M': {
                name: '50M Interconnect Cable',
                manual: 'N/A',
                wiring: 'N/A',
                guide: 'N/A'
            }
        };

        let currentIDs = [];
        let finalProducts = [];
        let textReportContent = ''; // Variable to hold the clean text report

        // --- 2. HTML ELEMENT REFERENCES ---
        const $ = id => document.getElementById(id);

        // Steps
        const stepScan = $('step-scan');
        const stepVerify = $('step-verify');
        const stepInstructions = $('step-instructions');

        // Scan/Input Elements
        const manualInput = $('manualInput');
        const addInputBtn = $('addInputBtn');
        const scannedIDs = $('scannedIDs');
        const doneScanningBtn = $('doneScanningBtn');

        // Verification Elements
        const finalProductList = $('finalProductList');
        const listCorrectBtn = $('listCorrectBtn');
        const listIncorrectBtn = $('listIncorrectBtn');
        const correctionArea = $('correctionArea');
        const correctionInput = $('correctionInput');
        const applyCorrectionBtn = $('applyCorrectionBtn');

        // Instructions Elements
        const instructionsContent = $('instructionsContent');
        const copyInstructionsBtn = $('copyInstructionsBtn');
        const copyStatus = $('copyStatus');


        // --- 3. CORE FUNCTIONS ---

        function updateScannedIDsDisplay() {
            scannedIDs.textContent = currentIDs.length > 0 ? currentIDs.join(', ') : 'None';
            doneScanningBtn.disabled = currentIDs.length === 0;
            doneScanningBtn.textContent = `‚úÖ Done Entering (${currentIDs.length} products)`;
        }

        function validateAndAddID(id) {
            // Simple cleanup/parsing: removes spaces, converts to uppercase
            const cleanID = id.trim().toUpperCase().replace(/[^A-Z0-9-]/g, ''); 
            
            if (!cleanID) {
                alert("Please enter a valid product ID.");
                return false;
            } else if (currentIDs.includes(cleanID)) {
                alert(`ID "${cleanID}" already added.`);
                return false;
            } else {
                currentIDs.push(cleanID);
                updateScannedIDsDisplay();
                return true;
            }
        }

        function compileProductList(ids) {
            finalProducts = ids.map(id => {
                const productInfo = FICTIONAL_PRODUCTS[id];
                return {
                    id: id,
                    found: !!productInfo, 
                    name: productInfo ? productInfo.name : `[ERROR: Model ${id} not recognized]`,
                    data: productInfo
                };
            });
            
            // Render the list for verification
            finalProductList.innerHTML = finalProducts.map(p => 
                `<div class="product-list-item" style="color: ${p.found ? 'green' : 'red'};">
                    <strong>${p.name}</strong> (${p.id})
                </div>`
            ).join('');
            
            // Move to the verification step
            stepScan.classList.add('hidden');
            stepVerify.classList.remove('hidden');
        }

        function generateInstructions(products) {
            let manualLinks = new Set();
            let wiringExamples = new Set();
            let guides = new Set();
            let html = '';
            let textReport = '--- Product Setup Instructions ---\n';
            textReport += `Products Verified: ${products.filter(p => p.found).map(p => p.name).join(', ')}\n\n`;


            // Aggregate data only from recognized products
            products.filter(p => p.found).forEach(p => {
                // Manual Links
                if (p.data.manual && p.data.manual !== 'N/A') manualLinks.add(`<li><a href="${p.data.manual}" target="_blank">${p.data.name} Manual Link</a></li>`);
                // Wiring Examples
                if (p.data.wiring && p.data.wiring !== 'N/A') wiringExamples.add(`<li><a href="${p.data.wiring}" target="_blank">Wiring Example Diagram: ${p.data.name}</a></li>`);
                // Silo/Bin Guides
                if (p.data.guide && p.data.guide !== 'N/A') guides.add(`<li>${p.data.guide}</li>`);
            });

            // --- HTML Output Generation ---
            if (manualLinks.size > 0) {
                html += '<h3>üìö Manuals & Product Links</h3><ul>' + Array.from(manualLinks).join('') + '</ul>';
                textReport += '1. Manuals & Links:\n' + Array.from(manualLinks).map(li => li.replace(/<a href="(.*?)".*?>(.*?)<\/a>/g, '$2: $1').trim()).join('\n') + '\n\n';
            }
            if (wiringExamples.size > 0) {
                html += '<h3>üîå Wiring Diagrams (Example)</h3><ul>' + Array.from(wiringExamples).join('') + '</ul>';
                textReport += '2. Wiring Examples:\n' + Array.from(wiringExamples).map(li => li.replace(/<a href="(.*?)".*?>(.*?)<\/a>/g, '$2: $1').trim()).join('\n') + '\n\n';
            }
            if (guides.size > 0) {
                html += '<h3>üìè Measurement & Setup Guide</h3><ul>' + Array.from(guides).join('') + '</ul>';
                textReport += '3. Measurement/Setup Guides:\n' + Array.from(guides).map(li => li.replace(/<[^>]*>/g, '').trim()).join('\n') + '\n\n';
            }

            if (html === '') {
                 instructionsContent.innerHTML = '<p style="color:red;">No specific instructions found for the approved list of products. Please contact support.</p>';
                 textReport += 'No instructions found. Please contact support.';
            } else {
                instructionsContent.innerHTML = html;
            }
            
            textReportContent = textReport; // Save the clean text version globally
            
            stepVerify.classList.add('hidden');
            stepInstructions.classList.remove('hidden');
        }


        // --- 4. EVENT LISTENERS AND STEP LOGIC ---

        // A. Manual Input
        addInputBtn.addEventListener('click', () => {
            if (validateAndAddID(manualInput.value)) {
                manualInput.value = '';
            }
        });

        manualInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addInputBtn.click();
            }
        });

        // B. Done Scanning
        doneScanningBtn.addEventListener('click', () => {
            compileProductList(currentIDs);
        });

        // C. Verification Step
        listCorrectBtn.addEventListener('click', () => {
            const verifiedIDs = finalProducts.filter(p => p.found).map(p => p.id);
            if (verifiedIDs.length > 0) {
                 generateInstructions(finalProducts);
            } else {
                alert("No recognizable products were found. Please use the 'No' button to manually correct the list.");
            }
        });

        listIncorrectBtn.addEventListener('click', () => {
            correctionArea.classList.remove('hidden');
            correctionInput.value = currentIDs.join(', '); // Pre-fill with current IDs
        });

        applyCorrectionBtn.addEventListener('click', () => {
            // Clean and process the comma-separated list
            const correctedIDs = correctionInput.value.split(',').map(id => id.trim().toUpperCase().replace(/[^A-Z0-9-]/g, '')).filter(id => id);
            
            if (correctedIDs.length > 0) {
                currentIDs = correctedIDs; // Overwrite current list with corrected list
                updateScannedIDsDisplay(); // Update display for current IDs
                compileProductList(currentIDs); // Re-run verification step
                correctionArea.classList.add('hidden'); // Hide the form
            } else {
                alert("The corrected list cannot be empty.");
            }
        });
        
        // D. Copy-to-Clipboard Functionality
        copyInstructionsBtn.addEventListener('click', () => {
            if (textReportContent) {
                // Use the modern Clipboard API
                navigator.clipboard.writeText(textReportContent)
                    .then(() => {
                        copyStatus.textContent = 'Instructions successfully copied! Now paste into your email.';
                        copyInstructionsBtn.textContent = '‚úÖ Copied!';
                        setTimeout(() => {
                            copyInstructionsBtn.textContent = 'üìã Copy Instructions to Clipboard';
                            copyStatus.textContent = '';
                        }, 3000);
                    })
                    .catch(err => {
                        // Fallback for older browsers or if permission is denied
                        console.error('Could not copy text: ', err);
                        copyStatus.textContent = 'Copy failed. Please manually select and copy the text displayed above.';
                        copyStatus.style.color = 'red';
                    });
            } else {
                 copyStatus.textContent = 'Error: No report content was generated.';
                 copyStatus.style.color = 'red';
            }
        });


        // Initial setup
        updateScannedIDsDisplay();
    </script>
</body>
</html>
