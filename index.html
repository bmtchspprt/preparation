<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Verification & Instructions</title>
    <style>
        /* Responsive CSS for Mobile/PC Friendliness */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #0056b3;
            text-align: center;
        }

        .step {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px 0;
            width: 100%; /* Full width on mobile */
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        input[type="text"], input[type="email"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0 20px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .product-list-item {
            padding: 8px;
            border-bottom: 1px dashed #eee;
        }

        .correction-form {
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 4px;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }

        /* Responsive Breakpoint for larger screens (PC) */
        @media (min-width: 600px) {
            button {
                width: auto;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üì¶ Silo Monitor Setup Assistant</h1>

        <div id="step-scan" class="step">
            <h2>1. Enter Product Label IDs</h2>
            <p>Please type the unique ID found on each product box label one at a time. The system will recognize the ID and compile your list.</p>

            <input type="text" id="manualInput" placeholder="Type Label ID (e.g., LEVEL-S-100)">
            <button id="addInputBtn">‚ûï Add Product ID</button>
            
            <p><strong>IDs Entered:</strong> <span id="scannedIDs">None</span></p>

            <button id="doneScanningBtn" disabled>‚úÖ Done Entering (0 products)</button>
        </div>

        <div id="step-verify" class="step hidden">
            <h2>2. Verify Product List</h2>
            <p>Please confirm the following product list matches the items you received:</p>
            
            <div id="finalProductList"></div>

            <button id="listCorrectBtn">‚úÖ Yes, the list is correct</button>
            <button id="listIncorrectBtn">‚ùå No, I need to correct it</button>

            <div id="correctionArea" class="correction-form hidden">
                <h3>Correction</h3>
                <p>Please enter the corrected, comma-separated list of ALL label IDs (e.g., LEVEL-S-100, GATEWAY-W-500):</p>
                <input type="text" id="correctionInput" placeholder="Enter corrected list of IDs">
                <button id="applyCorrectionBtn">Apply Correction & Verify</button>
            </div>
        </div>

        <div id="step-instructions" class="step hidden">
            <h2>3. Your Custom Instructions</h2>
            <p>Based on your products, here are the resources you need:</p>
            
            <div id="instructionsContent">
                </div>

            <button id="goToEmailBtn">‚û°Ô∏è Continue to Email Step</button>
        </div>

        <div id="step-email" class="step hidden">
            <h2>4. Email Instructions for Later</h2>
            <p>Would you like this information and links emailed to you for easy reference?</p>
            
            <input type="email" id="emailInput" placeholder="Your Email Address">
            <button id="sendEmailBtn">üìß Send Email</button>
            
            <p id="emailStatus" style="font-weight: bold; margin-top: 10px;"></p>
        </div>

    </div>

    <script>
        // --- 1. FICTIONAL PRODUCT DATA SIMULATION ---
        // A "Silo Monitoring System" is a good test product as it requires multiple components 
        // (sensor, gateway, cable) and specific installation instructions (silo measuring).
        const FICTIONAL_PRODUCTS = {
            'LEVEL-S-100': {
                name: 'High-Accuracy Level Sensor',
                manual: 'https://test-links.com/manual-level-sensor.pdf',
                wiring: 'https://test-links.com/diagram-level-sensor-std.png',
                guide: 'Measurement Guide: Conical Silo Headspace'
            },
            'GATEWAY-W-500': {
                name: 'Wireless Data Gateway',
                manual: 'https://test-links.com/manual-gateway-w500.pdf',
                wiring: 'https://test-links.com/diagram-power-data-gateway.png',
                guide: 'N/A'
            },
            'CABLE-20M': {
                name: '20M Power/Data Cable',
                manual: 'N/A',
                wiring: 'N/A',
                guide: 'N/A'
            },
            'TEMP-PROBE-01': {
                name: 'Temperature/Humidity Probe',
                manual: 'https://test-links.com/manual-temp-probe.pdf',
                wiring: 'https://test-links.com/diagram-level-sensor-std.png',
                guide: 'Measurement Guide: Flat-Bottom Bin Depth'
            }
        };

        let currentIDs = [];
        let finalProducts = [];

        // --- 2. HTML ELEMENT REFERENCES ---
        const $ = id => document.getElementById(id);

        // Steps
        const stepScan = $('step-scan');
        const stepVerify = $('step-verify');
        const stepInstructions = $('step-instructions');
        const stepEmail = $('step-email');

        // Scan/Input Elements
        const manualInput = $('manualInput');
        const addInputBtn = $('addInputBtn');
        const scannedIDs = $('scannedIDs');
        const doneScanningBtn = $('doneScanningBtn');

        // Verification Elements
        const finalProductList = $('finalProductList');
        const listCorrectBtn = $('listCorrectBtn');
        const listIncorrectBtn = $('listIncorrectBtn');
        const correctionArea = $('correctionArea');
        const correctionInput = $('correctionInput');
        const applyCorrectionBtn = $('applyCorrectionBtn');

        // Instructions Elements
        const instructionsContent = $('instructionsContent');
        const goToEmailBtn = $('goToEmailBtn');

        // Email Elements
        const emailInput = $('emailInput');
        const sendEmailBtn = $('sendEmailBtn');
        const emailStatus = $('emailStatus');


        // --- 3. CORE FUNCTIONS ---

        function updateScannedIDsDisplay() {
            scannedIDs.textContent = currentIDs.length > 0 ? currentIDs.join(', ') : 'None';
            doneScanningBtn.disabled = currentIDs.length === 0;
            doneScanningBtn.textContent = `‚úÖ Done Entering (${currentIDs.length} products)`;
        }

        function validateAndAddID(id) {
            // Simple cleanup/parsing: removes spaces, converts to uppercase
            const cleanID = id.trim().toUpperCase().replace(/[^A-Z0-9-]/g, ''); 
            
            if (!cleanID) {
                alert("Please enter a valid product ID.");
                return false;
            } else if (currentIDs.includes(cleanID)) {
                alert(`ID "${cleanID}" already added.`);
                return false;
            } else {
                currentIDs.push(cleanID);
                updateScannedIDsDisplay();
                return true;
            }
        }

        function compileProductList(ids) {
            finalProducts = ids.map(id => {
                const productInfo = FICTIONAL_PRODUCTS[id];
                return {
                    id: id,
                    // Check if the ID exists in our fictional database
                    found: !!productInfo, 
                    name: productInfo ? productInfo.name : `[ERROR: ID ${id} not recognized]`,
                    data: productInfo
                };
            });
            
            // Render the list for verification
            finalProductList.innerHTML = finalProducts.map(p => 
                `<div class="product-list-item" style="color: ${p.found ? 'green' : 'red'};">
                    <strong>${p.name}</strong> (${p.id})
                </div>`
            ).join('');
            
            // Move to the verification step
            stepScan.classList.add('hidden');
            stepVerify.classList.remove('hidden');
        }

        function generateInstructions(products) {
            let manualLinks = new Set();
            let wiringExamples = new Set();
            let guides = new Set();
            let html = '';

            // Aggregate data only from recognized products
            products.filter(p => p.found).forEach(p => {
                if (p.data.manual && p.data.manual !== 'N/A') manualLinks.add(`<li><a href="${p.data.manual}" target="_blank">${p.data.name} Operation Manual</a></li>`);
                if (p.data.wiring && p.data.wiring !== 'N/A') wiringExamples.add(`<li><a href="${p.data.wiring}" target="_blank">Wiring Example Diagram</a></li>`);
                if (p.data.guide && p.data.guide !== 'N/A') guides.add(`<li>${p.data.guide} Instructions</li>`);
            });

            if (manualLinks.size > 0) {
                html += '<h3>üìö Manuals & Product Links</h3><ul>' + Array.from(manualLinks).join('') + '</ul>';
            }
            if (wiringExamples.size > 0) {
                html += '<h3>üîå Wiring Diagrams</h3><ul>' + Array.from(wiringExamples).join('') + '</ul>';
            }
             if (guides.size > 0) {
                html += '<h3>üìè Silo/Bin Measurement Guide</h3><ul>' + Array.from(guides).join('') + '</ul>';
            }

            if (html === '') {
                 instructionsContent.innerHTML = '<p style="color:red;">No specific instructions found for the approved list of products. Please contact support.</p>';
            } else {
                instructionsContent.innerHTML = html;
            }
            
            stepVerify.classList.add('hidden');
            stepInstructions.classList.remove('hidden');
        }


        // --- 4. EVENT LISTENERS AND STEP LOGIC ---

        // A. Manual Input
        addInputBtn.addEventListener('click', () => {
            if (validateAndAddID(manualInput.value)) {
                manualInput.value = '';
            }
        });

        manualInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addInputBtn.click();
            }
        });

        // B. Done Scanning
        doneScanningBtn.addEventListener('click', () => {
            compileProductList(currentIDs);
        });

        // C. Verification Step
        listCorrectBtn.addEventListener('click', () => {
            // Filter out any IDs that were not recognized before generating instructions
            const verifiedIDs = finalProducts.filter(p => p.found).map(p => p.id);
            if (verifiedIDs.length > 0) {
                 generateInstructions(finalProducts);
            } else {
                alert("No recognizable products were found. Please use the 'No' button to manually correct the list.");
            }
        });

        listIncorrectBtn.addEventListener('click', () => {
            correctionArea.classList.remove('hidden');
            correctionInput.value = currentIDs.join(', '); // Pre-fill with current IDs
        });

        applyCorrectionBtn.addEventListener('click', () => {
            // Clean and process the comma-separated list
            const correctedIDs = correctionInput.value.split(',').map(id => id.trim().toUpperCase().replace(/[^A-Z0-9-]/g, '')).filter(id => id);
            
            if (correctedIDs.length > 0) {
                currentIDs = correctedIDs; // Overwrite current list with corrected list
                updateScannedIDsDisplay(); // Update display for current IDs
                compileProductList(currentIDs); // Re-run verification step
                correctionArea.classList.add('hidden'); // Hide the form
            } else {
                alert("The corrected list cannot be empty.");
            }
        });
        
        // D. Instructions Step
        goToEmailBtn.addEventListener('click', () => {
            stepInstructions.classList.add('hidden');
            stepEmail.classList.remove('hidden');
        });

        // E. Email Step (Simulated)
        sendEmailBtn.addEventListener('click', () => {
            const email = emailInput.value.trim();
            // Basic email regex validation
            if (email && /^\S+@\S+\.\S+$/.test(email)) {
                // *** SIMULATED EMAIL SENDING ***
                emailStatus.style.color = 'blue';
                emailStatus.textContent = `Sending instructions to ${email}...`;

                setTimeout(() => {
                    emailStatus.style.color = 'green';
                    emailStatus.innerHTML = `‚úÖ **Success!** Instructions have been sent to ${email}. Thank you!`;
                    sendEmailBtn.disabled = true;
                    emailInput.disabled = true;
                }, 2000); // Simulate network delay
                
            } else {
                emailStatus.style.color = 'red';
                emailStatus.textContent = 'Please enter a valid email address.';
            }
        });

        // Initial setup
        updateScannedIDsDisplay();
    </script>
</body>
</html>
